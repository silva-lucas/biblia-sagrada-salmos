<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Bíblia Sagrada</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root { --bg:#0b0f19; --text:#e5e7eb; --accent:#22d3ee; }
  * { box-sizing:border-box; }
  body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif; background:var(--bg); color:var(--text); }
  header { padding:24px 16px 12px; text-align:center; }
  h1 { margin:0; font-size:32px; font-family:'Cinzel', serif; }
  main { max-width:1100px; margin:0 auto; padding:12px 16px 28px; }
  .controls { display:flex; justify-content:flex-start; align-items:center; gap:12px; margin:10px 0 14px; flex-wrap:wrap; }
  button.tag { background:#1f2937; border:1px solid #374151; padding:8px 14px; border-radius:10px; color:#e5e7eb; cursor:pointer; font-size:16px; }
  .note { color:#9ca3af; font-size:15px; }
  .frameWrap { background:#000; border-radius:14px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,.5); }
  iframe { display:block; width:100%; height:72vh; border:0; background:#fff; }
  footer { text-align:center; padding:12px; color:#9ca3af; font-size:12px; }
</style>
</head>
<body>
  <header>
    <h1>Bíblia Sagrada</h1>
  </header>
  <main>
    <div class="controls">
      <button class="tag" id="psalmTag">Salmo da semana – —</button>
      <span class="note">Toda semana um novo Salmo.</span>
    </div>
    <div class="frameWrap">
      <iframe id="bibliaFrame" title="Salmo (ACF)"></iframe>
    </div>
  </main>
  <footer>Fonte: Bíblia Online (ACF) — bibliaonline.com.br</footer>

<script>
const ALL_PSALMS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150];

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function todayStr() {
  const d = new Date();
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}

function getISOWeek(d) {
  d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = d.getUTCDay() || 7;
  d.setUTCDate(d.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
  return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
}

function weekKey() {
  const d = new Date();
  const y = d.getUTCFullYear();
  const w = String(getISOWeek(d)).padStart(2, '0');
  return `${y}-W${w}`;
}

function getCycle() {
  let cycle = [];
  try { cycle = JSON.parse(localStorage.getItem('psalmsCycle') || '[]'); } catch { cycle = []; }
  if (!Array.isArray(cycle) || cycle.length !== ALL_PSALMS.length) {
    cycle = shuffle(ALL_PSALMS.slice());
    localStorage.setItem('psalmsCycle', JSON.stringify(cycle));
    localStorage.setItem('cycleIndex', '0');
    localStorage.setItem('lastTick', '');
  }
  return cycle;
}

function advanceIfNeeded(cycle) {
  const mode = 'weekly';
  let idx = parseInt(localStorage.getItem('cycleIndex') || '0', 10);
  let lastTick = localStorage.getItem('lastTick') || '';
  const currentTick = (mode === 'weekly') ? weekKey() : todayStr();
  if (lastTick !== currentTick) {
    idx = (idx + 1) % cycle.length;
    if (idx === 0) {
      cycle = shuffle(ALL_PSALMS.slice());
      localStorage.setItem('psalmsCycle', JSON.stringify(cycle));
    }
    localStorage.setItem('cycleIndex', String(idx));
    localStorage.setItem('lastTick', currentTick);
  }
  return { cycle, idx };
}

function currentPsalm() {
  let cycle = getCycle();
  let idx = parseInt(localStorage.getItem('cycleIndex') || '0', 10);
  if (!localStorage.getItem('lastTick')) {
    localStorage.setItem('lastTick', ('weekly' === 'weekly') ? weekKey() : todayStr());
  }
  const res = advanceIfNeeded(cycle);
  cycle = res.cycle; idx = res.idx;
  return cycle[idx];
}

function loadPsalm(n) {
  document.getElementById('psalmTag').textContent = ('weekly' === 'weekly' ? 'Salmo da semana – ' : 'Salmo do dia – ') + n;
  document.getElementById('bibliaFrame').src = 'https://www.bibliaonline.com.br/acf/sl/' + n;
}

const ps = currentPsalm();
loadPsalm(ps);

document.getElementById('psalmTag').addEventListener('click', () => location.reload());
</script>
</body>
</html>
